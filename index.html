<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>排行榜 — 无缝平移轮播（修复版）</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<style>
  body {
    margin: 0;
    height: 100vh;
    font-family: 'Poppins', sans-serif;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 1s ease;
    background: linear-gradient(135deg,#FFEFEF,#E8FFF8);
  }

  .scene {
    width: 900px;
    height: 600px;
    position: relative;
    overflow: hidden;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.15);
  }

  .slides {
    display:flex;
    height:100%;
    transition: transform 900ms ease;
    will-change: transform;
  }

  .slide {
    flex: 0 0 100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .card {
    width: 90%;
    height: 85%;
    border-radius: 16px;
    background: rgba(255,255,255,0.92);
    padding: 1rem;
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.08);
    overflow:auto;
    text-align:center;
  }

  h2 { font-size:1.7rem; margin-bottom:0.8rem; font-weight:600; }

  table { width:100%; border-collapse:collapse; font-size:1.1rem; }
  th,td { padding:0.55rem; border-bottom:1px solid #e6e6e6; }
  tr:nth-child(even){ background: rgba(0,0,0,0.03); }

  .nav-zone { position:absolute; top:0; width:50%; height:100%; z-index:8; cursor:pointer; }
  .nav-left{ left:0; } .nav-right{ right:0; }

  img.logo { position:absolute; top:14px; left:50%; transform:translateX(-50%); width:140px; z-index:9; }

  @media(max-width:800px){
    .scene{ width:100vw; height:80vh; border-radius:0; }
    h2{ font-size:1.3rem; }
    table{ font-size:0.95rem; }
  }
</style>
</head>
<body>
  <img class="logo" src="https://i.imgur.com/AbyTxH1.png" alt="logo">

  <div class="scene" id="scene">
    <div class="nav-zone nav-left" id="prevZone"></div>
    <div class="nav-zone nav-right" id="nextZone"></div>

    <div class="slides" id="slides">
      <!-- 原始四页（真实内容） -->
      <div class="slide" data-bg="linear-gradient(135deg,#FFD8B1,#FFDCC0)">
        <div class="card">
          <h2>🏆 本月个人贡献排行</h2>
          <table>
            <tr><th>名次</th><th>姓名</th><th>分数</th></tr>
            <tr><td>🥇 1</td><td>Albert</td><td>1320</td></tr>
            <tr><td>🥈 2</td><td>Aung Thant</td><td>1180</td></tr>
            <tr><td>🥉 3</td><td>Mei Ling</td><td>970</td></tr>
            <tr><td>4</td><td>Jin Wei</td><td>920</td></tr>
            <tr><td>5</td><td>Siti</td><td>870</td></tr>
          </table>
        </div>
      </div>

      <div class="slide" data-bg="linear-gradient(135deg,#FFDAC1,#FFE8D6)">
        <div class="card">
          <h2>🌍 年度团队贡献排行</h2>
          <table>
            <tr><th>名次</th><th>团队</th><th>分数</th></tr>
            <tr><td>🥇 1</td><td>Production</td><td>8200</td></tr>
            <tr><td>🥈 2</td><td>QA</td><td>7900</td></tr>
            <tr><td>🥉 3</td><td>Purchasing</td><td>7100</td></tr>
            <tr><td>4</td><td>Engineering</td><td>6900</td></tr>
            <tr><td>5</td><td>HR</td><td>6400</td></tr>
          </table>
        </div>
      </div>

      <div class="slide" data-bg="linear-gradient(135deg,#C1FFD7,#E8FFF0)">
        <div class="card">
          <h2>⚙️ 综合效率排行</h2>
          <table>
            <tr><th>名次</th><th>姓名</th><th>效率</th></tr>
            <tr><td>1</td><td>Albert</td><td>93%</td></tr>
            <tr><td>2</td><td>Aung Thant</td><td>88%</td></tr>
            <tr><td>3</td><td>Mei Ling</td><td>81%</td></tr>
            <tr><td>4</td><td>Jin Wei</td><td>79%</td></tr>
            <tr><td>5</td><td>Siti</td><td>76%</td></tr>
          </table>
        </div>
      </div>

      <div class="slide" data-bg="linear-gradient(135deg,#C1E1FF,#EAF6FF)">
        <div class="card">
          <h2>💖 部门士气排行榜</h2>
          <table>
            <tr><th>名次</th><th>部门</th><th>满意度</th></tr>
            <tr><td>🥇 1</td><td>QA</td><td>98%</td></tr>
            <tr><td>🥈 2</td><td>Production</td><td>94%</td></tr>
            <tr><td>🥉 3</td><td>Engineering</td><td>91%</td></tr>
            <tr><td>4</td><td>Admin</td><td>89%</td></tr>
            <tr><td>5</td><td>HR</td><td>87%</td></tr>
          </table>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const slidesEl = document.getElementById('slides');
  const scene = document.getElementById('scene');
  const prevZone = document.getElementById('prevZone');
  const nextZone = document.getElementById('nextZone');

  let realSlides = Array.from(slidesEl.querySelectorAll('.slide')); // 4 real slides
  const realCount = realSlides.length;

  // 克隆首尾用于无缝
  const firstClone = realSlides[0].cloneNode(true);
  const lastClone = realSlides[realSlides.length - 1].cloneNode(true);
  slidesEl.appendChild(firstClone);      // 在末尾追加 first clone
  slidesEl.insertBefore(lastClone, slidesEl.firstChild); // 在开头插入 last clone

  // 现在 slidesEl 包含： [clone-last, real1, real2, real3, real4, clone-first]
  let currentIndex = 1; // 指向真实第一张的位置（因为开头有一个 clone）
  let isAnimating = false;
  const transitionDuration = 900; // ms
  let autoTimer = null;
  const AUTO_INTERVAL = 8000;

  // 初始化位置（移动到 index=1）
  function setTranslateImmediate(index) {
    slidesEl.style.transition = 'none';
    slidesEl.style.transform = `translateX(-${index * 100}%)`;
    // 强制重绘以确保 transition none 生效后再恢复
    void slidesEl.offsetWidth;
  }

  function setTranslateWithAnim(index) {
    slidesEl.style.transition = `transform ${transitionDuration}ms cubic-bezier(.22,.9,.28,1)`;
    slidesEl.style.transform = `translateX(-${index * 100}%)`;
  }

  // 更新背景（基于真实 slide index）
  function updateBackgroundFromIndex(idx) {
    // idx is currentIndex (includes clones). real index = (idx -1)
    let realIdx = (idx - 1);
    if (realIdx < 0) realIdx = realCount - 1;
    if (realIdx >= realCount) realIdx = 0;
    const allReal = Array.from(slidesEl.querySelectorAll('.slide')).slice(1, 1 + realCount);
    const bg = allReal[realIdx].getAttribute('data-bg') || 'linear-gradient(135deg,#FFEFEF,#E8FFF8)';
    document.body.style.background = bg;
  }

  // 初始化
  setTranslateImmediate(currentIndex);
  updateBackgroundFromIndex(currentIndex);

  // 监听 transitionend 用于“跳位”逻辑
  slidesEl.addEventListener('transitionend', () => {
    isAnimating = false;
    // 如果到达 clone-first（末尾的 clone），立刻跳回真实 first（index =1）
    if (currentIndex === realCount + 1) {
      setTranslateImmediate(1);
      currentIndex = 1;
    }
    // 如果到达 clone-last（开头的 clone），立刻跳到真实 last（index = realCount）
    if (currentIndex === 0) {
      setTranslateImmediate(realCount);
      currentIndex = realCount;
    }
    updateBackgroundFromIndex(currentIndex);
  });

  function goNext() {
    if (isAnimating) return;
    isAnimating = true;
    currentIndex++;
    setTranslateWithAnim(currentIndex);
    updateBackgroundFromIndex(currentIndex);
    resetAuto();
  }

  function goPrev() {
    if (isAnimating) return;
    isAnimating = true;
    currentIndex--;
    setTranslateWithAnim(currentIndex);
    updateBackgroundFromIndex(currentIndex);
    resetAuto();
  }

  // 点击区域
  nextZone.addEventListener('click', goNext);
  prevZone.addEventListener('click', goPrev);

  // 触控支持
  let startX = 0;
  let moved = false;
  scene.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    moved = false;
  }, {passive:true});
  scene.addEventListener('touchend', (e) => {
    const diff = e.changedTouches[0].clientX - startX;
    if (Math.abs(diff) < 40) return;
    if (diff < 0) goNext(); else goPrev();
  });

  // 自动播放
  function startAuto(){
    stopAuto();
    autoTimer = setInterval(() => { goNext(); }, AUTO_INTERVAL);
  }
  function stopAuto(){
    if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
  }
  function resetAuto(){ stopAuto(); startAuto(); }

  // 防止页面不可见时继续跑（节省资源并避免错位）
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) stopAuto(); else startAuto();
  });

  // 启动
  startAuto();

  // 防止快速连续点两次（在 isAnimating 基础上再加个超时保险）
  slidesEl.addEventListener('transitionstart', () => {
    setTimeout(() => { isAnimating = false; }, transitionDuration + 50);
  });

})();
</script>
</body>
</html>


